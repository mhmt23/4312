<!DOCTYPE html>
<html>
<head>
    <title>Your Dashboard</title>
</head>
<body>
    <h2>Welcome, {{ user.username }}!</h2>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <a href="{% url 'home' %}">Home</a> |
    <a href="{% url 'my_profile' %}">Profile</a> |
    <a href="{% url 'create_service' %}">Create New Service</a>

    <hr>

    <h3>Services You Created</h3>
    <ul>
        {% for service in created_services %}
            <li>
                <a href="{% url 'service_detail' service.pk %}">{{ service.title }}</a>
                - Status: {{ service.get_status_display }}
                {% if service.assignee %}
                    (Assigned to: <a href="{% url 'profile' service.assignee.username %}">{{ service.assignee.username }}</a>)
                {% endif %}

                {% if service.status == 'in_progress' %}
                    <form action="{% url 'complete_service' service.pk %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit">Mark as Completed</button>
                    </form>
                {% elif service.status == 'completed' and service.id in services_to_review_ids %}
                    <a href="{% url 'create_review' service.pk %}">Leave a Review</a>
                {% endif %}
            </li>
        {% empty %}
            <li>You have not created any services yet.</li>
        {% endfor %}
    </ul>

    <hr>

    <h3>Services You Accepted</h3>
    <ul>
        {% for service in assigned_services %}
            <li>
                <a href="{% url 'service_detail' service.pk %}">{{ service.title }}</a>
                - Status: {{ service.get_status_display }}
                (Creator: <a href="{% url 'profile' service.creator.username %}">{{ service.creator.username }}</a>)

                {% if service.status == 'completed' and service.id in services_to_review_ids %}
                    <a href="{% url 'create_review' service.pk %}">Leave a Review</a>
                {% endif %}
            </li>
        {% empty %}
            <li>You have not accepted any services yet.</li>
        {% endfor %}
    </ul>

    <hr>

    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit">Logout</button>
    </form>
</body>
</html>
